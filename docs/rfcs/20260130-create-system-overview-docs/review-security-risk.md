## Security & Risk Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Approve

**判定基準:** P0 が1件以上存在する場合は Request Changes とする。P0 が0件の場合は Approve とする。

### 2. 良い点 (Strengths)

- **セクション 7.1 セキュリティとプライバシー**: ドキュメントのみの変更であることを前提に、環境変数セクションに機密値を含めない方針を明示している。`api-overview.md` の環境変数テーブルに「変数名・説明・デフォルト値のみ記載し、実際の API キーや SMTP パスワード等の機密値を含めない」と設計段階で注記している点は、機密情報の Git 履歴への混入を防ぐ上で適切である。
- **セクション 7.4 マイグレーションと後方互換性**: ロールバック手段として Git revert を明記しており、障害発生時の復旧方針が明確である。旧ドキュメント参照の検索範囲をリポジトリ内全ファイルに設定しており、参照切れによる影響を網羅的に検出する姿勢は堅実である。
- **セクション 6 代替案の検討**: 案C（非推奨マーク付き保持）を不採用とした判断は、重複ドキュメントの長期残存リスクを排除している。陳腐化したドキュメントが残り続けることは、誤った情報に基づく運用判断や設定変更を招くリスクがあるため、即時削除の判断は安全側に寄っている。
- **セクション 3 やらないこと**: コード変更を明示的にスコープ外としており、ドキュメント変更に伴うシステム動作の意図しない変更が発生しないことが保証されている。
- **セクション 4 既知の乖離点**: コードベースとの乖離を6項目にわたり具体的に列挙しており、実装時に陳腐化した情報をそのまま新ドキュメントに転記するリスクを低減している。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 定義 |
| :--- | :--- |
| **P0 (Blocker)** | 修正必須。論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 |
| **P1 (Nit)** | 提案。より良い手法、軽微な懸念、参考情報 |

#### 指摘一覧

**P0**: 該当なし

**[P1-1] 機密情報の誤記載に対する実装時の防御策の具体化**
- **対象セクション**: 7.1 セキュリティとプライバシー / 5.2 新ドキュメントの構成 > `docs/api-overview.md`
- **内容**: RFC は「機密値を含めない」という方針を明示しているが、実装時に `.env` ファイルの内容を参照しながらドキュメントを作成する際、API キーや SMTP パスワードの実値を誤ってコピー＆ペーストするリスクが存在する。`.env` は `.gitignore` に含まれているため Git リポジトリには入らないが、ドキュメント本文に機密値が記載された場合は Git 履歴に残り、`git filter-branch` や `git filter-repo` による完全削除が必要となる。コード変更は伴わないためシステム上のセキュリティ脆弱性には該当しないが、リポジトリが将来公開される可能性を考慮すると、予防策を具体化すべきである。
- **修正の期待値**: 実装計画のフェーズ3（検証）に「環境変数セクションに実際の機密値が含まれていないことを確認する」を明示的な検証項目として追加することを推奨する。参照元は `.env` ではなく `.env.example` とすることで誤記載リスクをさらに低減できる。

**[P1-2] 旧ドキュメント削除のタイミングに伴う一時的な情報空白リスク**
- **対象セクション**: 9. 実装・リリース計画 / 5.3 既存ファイルの削除
- **内容**: 実装計画ではフェーズ1（ドキュメント作成）とフェーズ2（旧ドキュメント削除・参照更新）を分離しているが、これらが単一コミットではなく複数コミットに分かれた場合、フェーズ2の削除が実行されてからフェーズ1の新ドキュメントが十分に検証されるまでの間に情報空白が発生する可能性がある。個人プロジェクトであり影響範囲は限定的であるが、障害対応中に旧ドキュメントが存在しない状態で新ドキュメントも不完全という状態は望ましくない。
- **修正の期待値**: フェーズ1とフェーズ2を同一ブランチ上で実施し、PR マージを以て一括反映する運用が望ましい。RFC の実装計画にその旨を補記することを推奨する。現状の記述でもフェーズ順序は明確であるため、実質的なリスクは低い。

**[P1-3] `api-overview.md` における Web サーバーのセキュリティ特性の記載**
- **対象セクション**: 5.2 新ドキュメントの構成 > `docs/api-overview.md` > Web サーバーエンドポイント
- **内容**: Web サーバーの `GET /p/:token` エンドポイントは、32文字のトークンによるアクセス制御と有効期限管理を備えている。現行コードでは HTML エスケープ（`escapeHtml`）によるXSS対策も実装されている。これらのセキュリティ特性はインターフェース設計の重要な要素であるが、RFC の `api-overview.md` 構成案ではトークン長と期限切れ時のHTTPステータス（410 Gone）のみが記載されている。ドキュメントにセキュリティ関連の設計判断を記載しておくことで、将来のエンドポイント追加や改修時に安全性の基準が明確になる。
- **修正の期待値**: `api-overview.md` の Web サーバーエンドポイントセクションまたはエラーハンドリング規約セクションに、以下のセキュリティ特性を記載することを推奨する。(1) トークンベースのアクセス制御（認証不要だが推測困難な32文字トークン）、(2) 有効期限による時限アクセス、(3) HTML エスケープによるXSS防御。ただし、これは既存コードの設計を反映するものであり、新たなセキュリティ要件を追加するものではない。

**[P1-4] エラーハンドラにおける内部情報露出の文書化**
- **対象セクション**: 5.2 新ドキュメントの構成 > `docs/api-overview.md` > Web サーバーエンドポイント
- **内容**: 現行の Web サーバーの 500 エラーハンドラは `err.message` をレスポンスに含めている（`src/server/index.ts` 42-51行目）。個人プロジェクトにおいては許容範囲であるが、内部エラーメッセージの露出はOWASP Top 10 の「Security Misconfiguration」に関連する。`api-overview.md` のエラーハンドリング規約セクションにこの挙動を文書化しておくことで、将来的にプロジェクトが公開された際の改善検討が容易になる。
- **修正の期待値**: `api-overview.md` のエラーハンドリング規約セクションに、500エラー時にエラーメッセージが返却される現行挙動を記載し、必要に応じて将来の改善候補として注記することを推奨する。これはドキュメントへの記載提案であり、コード変更は本 RFC のスコープ外である。
