## Security & Risk Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Approve

### 2. 良い点 (Strengths)

- **機密情報の取り扱い**: `api-overview.md` の環境変数セクションは変数名・説明・デフォルト値のみを記載しており、RFC セクション 7.1 の要件（実際の API キーや SMTP パスワード等の機密値を含めない）を遵守している。実際に `GOOGLE_BOOKS_API_KEY`、`SMTP_PASS`、`SMTP_USER`、`MAIL_TO` のいずれにも具体的な値は記載されていない。注記（「※ 環境変数セクションには変数名・説明・デフォルト値のみ記載し、実際の値は含めない。」）も明示されており、今後のメンテナンス時の誤混入リスクを低減している。

- **エラーハンドリング規約の網羅性**: `api-overview.md` のエラーハンドリング規約セクションは、Google Books API・SMTP・Web サーバーの各エラーパターンと対処方針を明記しており、障害時のフェイルセーフ設計が文書化されている。特に SMTP 障害時に「配信記録は更新しない（次回再選択）」という方針は、データ損失を回避する安全な失敗設計として妥当である。

- **旧ドキュメントの完全削除**: `docs/arch.md` および `docs/spec.md` が確実に削除されており、陳腐化したドキュメントが残存するリスクを排除している。`docs/ops.md` はスコープ外として維持しており、RFC セクション 3 の Non-Goals と整合している。

- **認証情報の分離**: `.env` ファイルが `.gitignore` に登録されており、ドキュメントに記載された環境変数の実際の値がリポジトリに混入するリスクは制度的に管理されている。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 定義 |
| :--- | :--- |
| **P0 (Blocker)** | 修正必須。論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 |
| **P1 (Nit)** | 提案。より良い手法、軽微な懸念、参考情報 |

#### 指摘一覧

**P0**: 該当なし

**[P1-1] 500 エラーレスポンスにおける `err.message` の情報漏洩リスクに関する記載不足**
- **対象セクション**: `api-overview.md` > Web サーバーエンドポイント > 500 エラーハンドラ
- **内容**: ドキュメントでは 500 エラーレスポンスの `message` フィールドを `"..."` と省略表記しているが、実装コード（`src/server/index.ts` 42行目）では `err.message` をそのままレスポンスに含めている。これは内部実装の詳細（DB パス、ファイルパス、ライブラリ内部のエラーメッセージ等）がクライアントに漏洩するリスクがある。現状は個人利用の CLI ツールであり実害は限定的であるが、ドキュメントにおいて「内部エラーメッセージが含まれる可能性がある」旨を明記するか、将来的にサーバーを外部公開する場合にはサニタイズを検討する旨を記載することが望ましい。
- **修正の期待値**: 以下のいずれかの対応を推奨する。（1）500 エラーレスポンスの `message` 記載を `"message": "<内部エラーメッセージ>"` のように表現し、内部情報が含まれることをドキュメント上で明示する。（2）本ドキュメントの範囲外であるが、将来的に `err.message` の代わりに汎用メッセージを返すリファクタリングを検討する。

**[P1-2] Web サーバーのバインドアドレスに関するセキュリティ注記の不足**
- **対象セクション**: `api-overview.md` > CLI インターフェース > dre serve、`architecture.md` > デプロイ構成
- **内容**: `dre serve` のデフォルトバインドホストが `0.0.0.0` であることが記載されているが、これは全ネットワークインターフェースでリッスンすることを意味し、意図せずローカルネットワークや外部からアクセス可能になるリスクがある。個人利用が前提であり、ドキュメント変更のみがスコープであるため P0 とはしないが、運用上の注意事項としてドキュメントに記載があると望ましい。
- **修正の期待値**: `dre serve` セクションまたはデプロイ構成セクションに、`0.0.0.0` がデフォルトである旨と、外部公開を意図しない場合は `127.0.0.1` の使用を推奨する注記を追加することを検討する。ただし、この注記は `docs/ops.md`（運用ガイド）に記載するほうが適切である可能性もあるため、配置先は判断に委ねる。
